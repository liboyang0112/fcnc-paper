%-------------------------------------------------------------------------------
\section{Analysis strategy}
\label{sec:strategy_Htautau}
%-------------------------------------------------------------------------------

The analysis strategy adopted in the $\Htautau$ search follows that developed in Ref.~\cite{Chen:2015nta} but improved to apply to more signal regions.

\subsection{Event categorisation and kinematic reconstruction}
\label{sec:htautau_reco_cat}

The $tt(qH)$ and $tH$ signal being probed is characterised by the presence of $\tau$-leptons from the decay of 
the Higgs boson and the remaining $t\to Wb$ decay as well as an additional $q$-jet for $t\to qH$ decay. 
%at least  four (three) jets in the decay (production) mode, only one of which originates from a $b$-quark.
If the $W$ boson or one of the $\tau$-leptons decays leptonically, an isolated electron or muon and significant $\met$ is also expected.
In a significant fraction of the events, the lowest-$\pt$ jet from the hadronic $W$ boson decay fails the minimum $\pt$ requirement of $25~\gev$,
resulting in some decay mode signal events mixed with production mode having only three jets reconstructed.
In order to optimise the sensitivity of the search, the selected events are categorised into seven SRs depending on the number of leptons and
$\had$ candidates, and on the number of light flavored jets:
$t_l\hadhad$, $t_l\had$-1j, $t_l\had$-2j, $t_h\lephad$-2j, $t_h\lephad$-3j, $t_h\hadhad$-2j, and $t_h\hadhad$-3j, as shown in Table~\ref{tab:srcr}. 

\begin{table}
\centering
\caption{Overview of the signal regions and the control regions used for fake tau scale factor derivation in leptonic channels.}
\label{tab:srcr}
\begin{tabular}[h]{c|c|c|c|c|c|c}
\hline \hline
\multicolumn{2}{c|}{Regions} & b-jet & light flavor jets        & lepton & hadronic taus & charge\\ \hline
\multirow{7}{*}{SR}&$t_l\thadhad$     & 1     & any                                & 1      & 2             & $\thadhad$ OS\\ \cline{2-7}
&$t_l\tauhad$-1j  & 1     & 1                                   & 1      & 1                     & $t_l\tauhad$ SS\\ \cline{2-7}
&$t_l\tauhad$-2j  & 1     & 2                                        & 1      & 1                     & $t_l\tauhad$ SS\\ \cline{2-7}
&$t_h\tlhad$-2j   & 1     & 2                           & 1      & 1             & $\tlhad$ OS\\ \cline{2-7}
&$t_h\tlhad$-3j   & 1     & $\ge3$                      & 1      & 1             & $\tlhad$ OS\\ \cline{2-7}
&$t_h\thadhad$-2j & 1     & 2                            & 0      & 2             & $\thadhad$ OS\\ \cline{2-7}
&$t_h\thadhad$-3j & 1     & $\ge3$                       & 0      & 2             & $\thadhad$ OS\\ \hline
\multirow{6}{*}{CRtt}&$t_lt_l1b\tauhad$ & 1     & any                           & 2      & 1                     & $t_lt_l$ OS\\ \cline{2-7}
&$t_lt_l2b\tauhad$      & 2     & any                           & 2      & 1                     & $t_lt_l$ OS\\ \cline{2-7}
&$t_lt_h2b\tauhad$-2jSS & 2     & 2                             & 1      & 1             & $t_l\tauhad$ SS\\ \cline{2-7}
&$t_lt_h2b\tauhad$-2jOS & 2     & 2                             & 1      & 1             & $t_l\tauhad$ OS\\ \cline{2-7}
&$t_lt_h2b\tauhad$-3jSS & 2     & $\ge3$                        & 1      & 1             & $t_l\tauhad$ SS\\ \cline{2-7}
&$t_lt_h2b\tauhad$-3jOS & 2     & $\ge3$                & 1      & 1             & $t_l\tauhad$ OS\\ \hline
\end{tabular}
\end{table}

%This event categorisation is primarily motivated by the different quality of the event kinematic reconstruction, depending on the amount 
%of $\met$ in the event (larger in $\lephad$ events compared with $\hadhad$ events), and whether a jet from the hadronic top-quark decay 
%is missing or not (events with exactly three jets or at least four jets).
This event categorisation is primarily motivated by optimizing the sensitivity in each signal region that targets both leptonic and hadronic top-quark
decays as well as the Higgs decays into $\lephad$ or $\hadhad$ final state.   
The event kinematic reconstruction is further applied to suppress the background based on the strategy used in Ref.~\cite{Chen:2015nta}, and is summarised below.

For the $t_ht(qH)$ events, there should be at least four jets among which the one with the smallest angular distance to the visible decay product of the
Higgs boson (the two tau candidates) is considered as $q$-jet since the top decay products are likely boosted closer together than other jets. 
If there are more than 2 jets beside $q$-jet and $b$-jet, the jets from $W$ boson decay are chosen from the combination which have the invariant mass closest
to W resonance. There is the chance that one of the jets fails the $\pt$ requirement and not reconstructed. The FCNC top resonance is still reconstructable
given the big chance that the jet which is missing is from $W$ decay.

In the $t_hH$ events, there are 3 jets coming from top hadronic decay including the b-jet. So a Higgs resonance formed by the taus and a top resonance formed by
the jets are expected.

Finally, the four-momenta of the invisible decay products for each $\tau$-lepton decay 
are estimated from kinematics fit. The fit is done by minimising a $\chi^2$ function based on the Gaussian constraints on the the Higgs boson mass and the
measured $\met$ within their expected resolutions. The resolution on the Higgs boson mass is taken to be $20~\gev$, respectively, while the resolution on the measured $\met$ is parameterised as a linear function of 
$\sqrt{\sum E_T}$, with $\sum E_T$ denoting the scalar sum of the $\pt$ of all physics objects contributing to the $\met$ reconstruction~\cite{Aaboud:2018tkc}.
After the $\chi^2$ minimisation, the Higgs boson four-momentum, and hence its invariant mass, as well as the 
four-momentum of the parent top quark in the decay mode signal events, are determined with better resolution. 

Following the event kinematic reconstruction, several kinematic variables that discriminate between signal and background are defined. These variables are used in the multivariate analysis discussed in the next section.

In the  $t_lt(qH)$ and $t_lH$ signal, the additional $q$ jet in the decay mode can still be found, but since the $W$ boson decays leptonically, there is a neutrino with large momentum and the flying direction is unknown. The kinematics fit is no longer feasible in the $t_l\hadhad$ channel. The variables calculated from the visible objects are directly used in the multivariate analysis. However, the kinematics fit is still performed for the $t_l\had$ channels where the lepton and $\had$ are treated as di-tau candidate.

\subsection{Multivariate discriminant}

%%%%%%%%%%%%%%%
\begin{table*}[t!]
\caption{\small{$\Htautau$ search: Discriminating variables used in the training of the BDT for hadronic channel. 
    The description of each variable is provided in the text.}}
\label{tab:importance_xTFW}
\input{\FCNCTables/Importance/xTFW/Merged}
\end{table*}


\begin{table*}[t!]
\caption{\small{$\Htautau$ search: Discriminating variables used in the training of the BDT for leptonic channel. 
    The description of each variable is provided in the text.}}
\label{tab:importance_tthML}
\input{\FCNCTables/Importance/tthML/Merged}
\end{table*}
%%%%%%%%%%%%%%%

Boosted decision trees are used in each SR to improve the separation between signal and background. 
%The separate training exploits differences in event kinematics across SRs.  
%draft 1 version
In the training, All signal events ($tt(qH)$ and $tH$ signal are merged together) are used either for $tHu$ or $tHc$  $q=c,u$ against the total SM background (including both real and fake $\had$ contributions).

A large set of potential variables were investigated in each SR separately. The discrimination of a given variable was quantified by the ``separation" and ``importance" measures provided by the TMVA package~\cite{Hocker:2007ht}, and only those variables whose importance is large than 1\% were kept.
The BDT input variables in each SR and their importance are listed in Table~\ref{tab:importance_tthML}-~\ref{tab:importance_xTFW} and defined in the following:
\begin{itemize}
\item $E^{T}_{miss}$ is the missing transverse momentum.
\item $p_{T,\tau}$ is the transverse momentum of the leading tau candidate.
\item $p_{T,sub-\tau}$ is the transverse momentum of the sub-leading tau candidate.
\item $p_{T,l}$ is the transverse momentum of the leading lepton.
\item $\chi^2$ is derived from kinematic fitting for the neutrinos.
\item $m_{t,SM}$ is the invariant mass of the $b$-jet and the two jets from the $W$ decay, and reflects the top mass in the decay $t\to Wb \to j_1j_2b$. This variable is only defined for the 4-jet $t_hH$ and $t_ht(qH)$ events.
\item $m^{T}_{W}$ is the transverse mass calculated from the lepton and $\met$ in the leptonic channels, defined as
\begin{equation}
m^{T}_{W} = \sqrt{2 p_{\text{T,lep}} E_{\text{T}}^{\text{miss}} \left(1-\cos\Delta\phi_{\text{lep,miss}} \right)}.  
\end{equation}
\item $m_{\tau,\tau}$ is the invariant mass of the tau candidates and reconstructed neutrinos in $t_hH$, $t_ht(qH)$, and $t_l\had$ channels. 
\item $m_{W}$ is the reconstructed invariant mass of the hadronic $W$ boson from SM top quark.
\item $m_{t,FCNC}$ is the visible invariant mass of the FCNC-decaying top quark reconstructed from di-tau candidates, $q$-jet and reconstructed neutrinos.
\item $m_{\tau\tau,vis}$ is the visible invariant mass of the di-tau candidates or the lepton and $\had$ candidate when there is only one $\had$.
\item $p_{T,\tau\tau,vis}$ is the $\pt$ of the di-tau candidates.
\item $m_{t,FCNC,vis}$ is the reconstructed visible mass of the FCNC-decaying top quark.
\item $m_{t,SM,vis}$ is the invariant mass of the lepton and the b-jet, which reflects the visible SM top mass.
\item $M(\tau\tau qjet,min)$ is the visible mass of the di-tau candidates (include leptonic tau) and the light-flavor jet, minimized by choosing different jet, reflects the invariant masss of the visible FCNC top decaying product, an alternative of variable $m_{t,FCNC,vis}$.
\item $M(wjet1,wjet2,min)$ is the invariant mass of two light-flavor jet, minimized by choosing different jets, reflects the invariant mass of the W candidate, an alternative of $m_{W}$.
\item $E^{T}_{miss}$ centrality is a measure of how central the $\met$ lies between the two tau candidates in the transverse plane, and is defined as
\begin{eqnarray}
\begin{array}{l}
\met~\text{centrality} = {(x+y)}/{\sqrt{x^2+y^2}}, \\
\text{with}~x=\frac{\sin(\phi_{\text{miss}}-\phi_{\tau_1})}{\sin(\phi_{\tau_2}-\phi_{\tau_1})},  y=\frac{\sin(\phi_{\tau_2}-\phi_{\text{miss}})}{\sin(\phi_{\tau_2}-\phi_{\tau_1})} ,
\end{array}
\label{eq:eq3}
\end{eqnarray}
\item $E_{\nu,i}/E_{\tau,i},i=1,2$ is the momentum fraction carried by the visible decay products from the tau mother. It is based on the best-fit 4-momentum of the neutrino(s) according to the event reconstruction algorithm in this section. For the $\tauhad$ decay mode, the visible decay products carry most of the tau energy since there is only a single neutrino in the final state.% which is evident in the excess around 1 in Figure \ref{fig:x12_fit}. 
\item $\Delta R(l+bjet,\tau\tau)$ is the angular distance between the lepton+b-jet and di-tau candidates.
\item $\Delta R(l,bjet)$ is the angular distance between the lepton and b-jet.
\item $\Delta R(\tau,bjet)$ is the angular distance between the tau and b-jet. If there are two taus in the event, the leading one is selected for the calculation.
\item $\eta_{\tau,max}$ is the maximum $\eta$ value among the tau candidates.
\item $\Delta R(l,\tau)$ is the angular distance between the lepton and the closest tau candidate in the leptonic channels.
\item $\Delta R(\tau,qjet)$ is the angular distance between the tau and the reconstructed $q$-jet.
\item $\Delta R(\tau,\tau)$ is the angular distance between two tau candidates, in case of $t_h\tlhad$ channels, the definition is the same as $\Delta R(l,\tau)$.
\item $\Delta\phi(\tau\tau,P^{T}_{miss})$ is the azimuthal angle between the $\met$ and di-tau $\pt$.
\end{itemize}
A comparison between data and the predicted background for some of these variables in three main decay final states($t_l\hadhad$, $t_h\hadhad$, and $t_h\lephad$)
is shown in Figures~\ref{fig:mva_input_l2had_hadhad_lephad}.
%each of the SRs considered is shown in Figures~\ref{fig:mva_input_hadhad} -~\ref{fig:mva_input_lhadhad}.
The comparison between the data and predicted background after preselection for the distributions of two of the most 
discriminating BDT input variables in the $\hadhad$ channel before the fit to data (``Pre-Fit'').
The expected signals (dashed red) are also shown after normalized to the total number of events un the predicted
background for the shape comparison of the distributions.   
%corresponding to $\BR(t\to Hq)=0.2\%$ is also shown.
The first and the last bins in the figures contain the underflow and overflow respectively.
The bottom panel displays the ratio of data to the SM background (``Bkg'') prediction.
The hashed area represents the total uncertainty of the background.
A good description of the data by the background model is observed in all cases.

The final observable used to extract signal events is defined as the BDT distribution in each SRs corresponding to either $tHu$ or $tHc$ signal training.
Figure~\ref{fig:asimov_fitbdt_thu} and~\ref{fig:asimov_fitbdt_thc} show the fits to the data of BDT observable in each SRs with all background processes
constrained to the SM expectation.
%The level of discrimination between signal and background achieved by the BDTs is illustrated in Figure~\ref{fig:overtrain_hadhad}-~\ref{fig:overtrain_lhadhad}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{\FCNCFigures/tex/BDTinput}

%\input{\FCNCFigures/tex/BDT}
